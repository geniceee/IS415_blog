---
title: "Take-home Exercise 2"
description: |
  This take-home exercise aims to perform spatial point patterns analysis of Airbnb listings in Singapore.
author:
  - name: Genice Goh
    url: {}
date: 09-25-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
set.seed(1234)
```

## 1.0 Introduction

Singapore is one of the few global cities that has yet to legalise short-term rentals offered by platforms such as Airbnb. However, it is interesting to note that there are data sets for Singapore available in Inside Airbnb - an independent, non-commercial set of tools and data that allows the exploration of how Airbnb is being used in cities around the world.

As such, we will like to use these data sets to analyse the following:

- If the distribution of Airbnb Listings in 2019 are affected by location factors (i.e. hotels, MRT services and tourist attractions)
- The impact of COVID-19 on Airbnb business in Singapore 

## 2.0 The Data

The data sets used for this analysis include:

- Airbnb listings for June 2019 and June 2021 from [Inside Airbnb]("http://insideairbnb.com/get-the-data.html")
- Hotels and tourist attractions extracted from SLA OneMap Service by using [onemapsgapi](https://cran.r-project.org/web/packages/onemapsgapi/index.html)
- Master Plan 2014 Subzone Boundary (Web) from [data.gov.sg](https://data.gov.sg/)
- National boundary of Singapore provided by SLA

## 3.0 Installing and Loading Packages

The packages used for this analysis include:

- sf: used for importing, managing, and processing geospatial data
- spatstat: used for performing spatial point pattern analysis 
- raster: used to read, write, manipulate, analyse and model gridded spatial data
- maptools: a set of tools for manipulating geographic data
- tmap: used for creating thematic maps, such as choropleth maps
- tidyverse: a collection of packages for data science tasks

```{r echo=TRUE}
packages = c('sf', 'spatstat', 'raster', 'maptools', 'tmap', 'tidyverse')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```

## 4.0 Importing Geospatial Data

*st_read()* of **sf** package is used to import the geospatial data, which is in **shapefile** format.

```{r echo=TRUE}
mrt_sf <- st_read(dsn="data/geospatial",
               layer="MRTLRTStnPtt")

sg_sf <- st_read(dsn="data/geospatial",
               layer="CostalOutline")

mpsz_sf <- st_read(dsn="data/geospatial",
               layer="MP14_SUBZONE_WEB_PL")
```

From the output message, we can see that:

- There are **185 point features** and **3 fields** in the `mrt_sf` sf data frame.
- There are **60 polygon features** and **4 fields** in the `sg_sf` sf data frame.
- There are **323 multi-polygon features** and **15 fields** in the `mpsz_sf` sf data frame.
- SVY21 is the **Projected Coordinates Reference System** for all 3 sf data frames. 

### 4.1 Data Preprocessing

Before we visualise the geospatial data, we will need to conduct data preprocessing to ensure that there are no invalid geometries and missing values.

#### 4.1.1 Invalid Geometries

```{r echo=TRUE}
length(which(st_is_valid(mrt_sf) == FALSE))
length(which(st_is_valid(sg_sf) == FALSE))
length(which(st_is_valid(mpsz_sf) == FALSE))
```

There are **no invalid geometries** in the `mrt_sf` data frame while the `sg_sf` data frame and `mpsz_sf` data frame contains **1 and 9 invalid geometries respectively**. We will now proceed to remove the invalid geometries in the `sg_sf` and `mpsz_sf` data frames. 

```{r echo=TRUE}
sg_sf <- st_make_valid(sg_sf)
mpsz_sf <- st_make_valid(mpsz_sf)

length(which(st_is_valid(sg_sf) == FALSE))
length(which(st_is_valid(mpsz_sf) == FALSE))
```

From the output message, we can observe that there are no longer any invalid geometries in the `sg_sf` and `mpsz_sf` data frames!

#### 4.1.2 Missing Values

```{r echo=TRUE}
mrt_sf[rowSums(is.na(mrt_sf))!=0,]
mrt_sf[rowSums(is.na(sg_sf))!=0,]
mrt_sf[rowSums(is.na(mpsz_sf))!=0,]
```

We can see that there are no missing values in all 3 sf data frames.

### 4.2 Verify Coordinate Reference System

We will first need to retrieve the coordinate reference system for verification. *st_crs()* of **sf** package is used to do this. 

```{r echo=TRUE}
st_crs(mrt_sf)
st_crs(sg_sf)
st_crs(mpsz_sf)
```

From the output messages, we can observe that the EPSG code for all 3 data frames is currently **9001**. This is **wrong** because the EPSG code of projection coordinate system SVY21 is supposed to be **3414**, instead of 9001. 
*st_set_crs()* of **sf** package is therefore used to assign the correct EPSG code for the data frames.

```{r echo=TRUE}
mrt_sf <- st_set_crs(mrt_sf, 3414)
sg_sf <- st_set_crs(sg_sf, 3414)
mpsz_sf <- st_set_crs(mpsz_sf, 3414)
```

We will now use *st_crs()* of **sf** package to retrieve the coordinate reference system again.

```{r echo=TRUE}
st_crs(mrt_sf)
st_crs(sg_sf)
st_crs(mpsz_sf)
```

The EPSG code is now correctly assigned for all 3 sf data frames!!

### 4.3 Visualising Geospatial Data

It is useful to plot a map to visualise the geospatial data, so that we can easily get a preliminary look at the spatial patterns. 

```{r echo=TRUE}
tmap_mode('view')

tm_shape(mrt_sf) +
  tm_dots() 
```

```{r}
tmap_mode('plot')
```






